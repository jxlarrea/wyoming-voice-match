services:
  voice-match:
    build:
      context: .
      dockerfile: Dockerfile
    image: wyoming-voice-match:latest
    container_name: wyoming-voice-match
    restart: unless-stopped
    ports:
      - "10350:10350"
    volumes:
      - ./data:/data
    environment:
      - UPSTREAM_URI=tcp://wyoming-faster-whisper:10300
      - THRESHOLD=0.30
      - LISTEN_URI=tcp://0.0.0.0:10350
      - DEVICE=cuda
      - HF_HOME=/data/hf_cache
      - LOG_LEVEL=DEBUG
      # - MAX_VERIFY_SECONDS=5.0   # First-pass verification window
      # - WINDOW_SECONDS=3.0       # Sliding window size for fallback pass
      # - STEP_SECONDS=1.5         # Sliding window step size
      # - ASR_MAX_SECONDS=10.0     # Max audio duration forwarded to ASR
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]