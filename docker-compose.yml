services:
  wyoming-voice-match:
    image: ghcr.io/jxlarrea/wyoming-voice-match:latest
    container_name: wyoming-voice-match
    restart: unless-stopped
    ports:
      - "10350:10350"
    volumes:
      - ./data:/data
    environment:
      - UPSTREAM_URI=tcp://wyoming-faster-whisper:10300
      - LISTEN_URI=tcp://0.0.0.0:10350
      - VERIFY_THRESHOLD=0.30
      - EXTRACTION_THRESHOLD=0.25
      - LOG_LEVEL=DEBUG
      - HF_HOME=/data/hf_cache
      # - REQUIRE_SPEAKER_MATCH=true       # Set to false to forward unmatched audio
      # - TAG_SPEAKER=false                # Prepend [speaker_name] to transcripts
      # - MAX_VERIFY_SECONDS=5.0           # First-pass verification window
      # - VERIFY_WINDOW_SECONDS=3.0        # Sliding window size for fallback pass
      # - VERIFY_STEP_SECONDS=1.5          # Sliding window step size
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]